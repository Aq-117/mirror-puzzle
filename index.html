<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Laser Mirror Puzzle</title>
  <link rel="stylesheet" href="./src/style.css">
</head>

<body>
  <div id="app">
    <div id="home-screen" class="screen">
      <h1 class="game-title">LASER<br>PUZZLE</h1>
      <div class="menu-buttons">
        <button id="home-levels-btn">LEVELS</button>
        <button id="home-settings-btn">SETTINGS</button>
        <button id="home-editor-btn">LEVEL EDITOR</button>
        <button id="generate-btn" style="margin-top: 10px; font-size: 0.8em; opacity: 0.8;">GENERATE RANDOM
          LEVEL</button>
      </div>
    </div>

    <div id="level-select-screen" class="screen hidden">
      <h2>SELECT LEVEL</h2>
      <div id="level-grid">
        <!-- Generated by JS -->
      </div>
      <button id="back-home-btn" class="back-btn">BACK</button>
    </div>

    <div id="settings-screen" class="screen hidden">
      <h2>SETTINGS</h2>
      <div class="setting-row">
        <label>MUSIC</label>
        <input type="range" id="music-vol" min="0" max="1" step="0.1" value="0.5">
      </div>
      <div class="setting-row">
        <label>SOUND</label>
        <input type="range" id="sfx-vol" min="0" max="1" step="0.1" value="0.5">
      </div>
      <button id="back-home-settings-btn" class="back-btn">BACK</button>
    </div>

    <!-- Level Editor Screen -->
    <div id="editor-screen" class="screen hidden">
      <div class="editor-top-bar">
        <h2>LEVEL EDITOR</h2>
        <div class="grid-controls">
          <label>W:</label> <input type="number" id="editor-width" value="8" min="3" max="20">
          <label>H:</label> <input type="number" id="editor-height" value="8" min="3" max="20">
          <button id="editor-update-grid">RESIZE</button>
        </div>
        <div class="editor-actions">
          <button id="editor-test-btn">TEST</button>
          <button id="editor-export-btn">EXPORT</button>
          <button id="editor-exit-btn">EXIT</button>
        </div>
      </div>

      <div class="editor-overlay">
        <div class="palette-left">
          <!-- CELL_TYPES mapped manually to ensure they match Grid.js -->
          <button class="editor-tool selected" data-type="1" title="Wall">WALL</button>
          <button class="editor-tool" data-type="2" title="Source/Emitter">EMIT</button>
          <button class="editor-tool" data-type="3" title="Receiver">RECV</button>
          <button class="editor-tool" data-type="6" title="Mirror 1 (Triangle)">M1</button>
          <button class="editor-tool" data-type="7" title="Mirror 2 (Line)">M2</button>
          <button class="editor-tool" data-type="8" title="Mirror 3 (Octagon)">M3</button>
          <button class="editor-tool" data-type="9" title="Mirror 4 (Square)">M4</button>
          <button class="editor-tool" data-type="10" title="Mirror 5 (Omni)">M5</button>
          <button class="editor-tool" data-type="0" title="Eraser">ERASE</button>
        </div>

        <div class="palette-bottom">
          <label>Inventory:</label>
          <div class="inv-input">M1: <input type="number" id="editor-m1-count" value="0" min="0"></div>
          <div class="inv-input">M2: <input type="number" id="editor-m2-count" value="0" min="0"></div>
          <div class="inv-input">M3: <input type="number" id="editor-m3-count" value="0" min="0"></div>
          <div class="inv-input">M4: <input type="number" id="editor-m4-count" value="0" min="0"></div>
          <div class="inv-input">M5: <input type="number" id="editor-m5-count" value="0" min="0"></div>
        </div>
      </div>

      <!-- Code Modal -->
      <div id="code-modal" class="modal hidden">
        <div class="modal-content">
          <h3>Level JSON</h3>
          <textarea id="level-json-code" readonly></textarea>
          <button id="close-modal-btn"
            onclick="document.getElementById('code-modal').classList.add('hidden')">CLOSE</button>
          <p class="hint">Copy this code and paste it into src/levels.js</p>
        </div>
      </div>
    </div>

    <div id="ui-layer" class="hidden">
      <div id="level-info">
        <h1 id="level-title">Level 1</h1>
        <p id="level-desc">Guide the laser to the target.</p>
        <button id="game-home-btn" class="icon-btn" style="position: absolute; top: 20px; left: 20px;">
          <div class="icon-home"></div>
        </button>
      </div>
      <div id="controls">
        <div class="inventory-item" id="select-m1">
          <div class="icon-box">
            <div class="icon-m1"></div>
          </div>
          <span id="m1-count">0</span>
        </div>
        <div class="inventory-item" id="select-m2">
          <div class="icon-box">
            <div class="icon-m2"></div>
            <div class="icon-lock hidden"></div>
          </div>
          <span id="m2-count">0</span>
        </div>
        <div class="inventory-item" id="select-m3">
          <div class="icon-box">
            <div class="icon-m3"></div>
            <div class="icon-lock hidden"></div>
          </div>
          <span id="m3-count">0</span>
        </div>
        <div class="inventory-item" id="select-m4">
          <div class="icon-box">
            <div class="icon-m4"></div>
            <div class="icon-lock hidden"></div>
          </div>
          <span id="m4-count">0</span>
        </div>
        <div class="inventory-item" id="select-m5">
          <div class="icon-box">
            <div class="icon-m5"></div>
            <div class="icon-lock hidden"></div>
          </div>
          <span id="m5-count">0</span>
        </div>
        <button id="undo-btn">Undo</button>
        <button id="reset-btn">Reset</button>
        <button id="next-level-btn" disabled>Next Level</button>
      </div>
    </div>
    <canvas id="game-canvas"></canvas>
    <div id="victory-popup" class="hidden">
      <div class="popup-content">
        <h2>CONGRATULATIONS!</h2>
        <p>You beat all levels.</p>
        <p>New levels coming soon.</p>
        <button id="restart-game-btn">Play Again</button>
      </div>
    </div>
  </div>
  <script type="module" src="/src/main.js"></script>
</body>

</html>